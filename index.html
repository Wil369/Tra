<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Flight Simulator</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        canvas { 
            display: block; 
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
        }
        #score {
            position: absolute;
            top: 10px;
            right: 10px;
            color: white;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            font-size: 1.2em;
        }
        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            z-index: 100;
        }
        #startScreen h1 {
            font-size: 3em;
            margin-bottom: 20px;
            color: #4CAF50;
            text-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }
        #startScreen input {
            padding: 10px;
            margin-bottom: 20px;
            width: 300px;
            font-size: 1.2em;
            text-align: center;
            border-radius: 5px;
            border: none;
        }
        .button {
            padding: 10px 20px;
            font-size: 1.2em;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: background-color 0.3s;
        }
        .button:hover {
            background-color: #45a049;
            transform: scale(1.05);
        }
        #aircraftSelection {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
            width: 80%;
            max-width: 800px;
        }
        .aircraft-option {
            background-color: rgba(0, 0, 0, 0.5);
            padding: 15px;
            margin: 10px;
            border-radius: 5px;
            width: 200px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, background-color 0.3s;
        }
        .aircraft-option:hover {
            background-color: rgba(76, 175, 80, 0.3);
            transform: scale(1.05);
        }
        .aircraft-option.selected {
            background-color: rgba(76, 175, 80, 0.5);
            border: 2px solid #4CAF50;
        }
        .aircraft-option img {
            width: 150px;
            height: 100px;
            object-fit: contain;
            margin-bottom: 10px;
        }
        .aircraft-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        .stat-bar {
            height: 10px;
            background-color: #ddd;
            border-radius: 5px;
            width: 100%;
            margin-top: 5px;
        }
        .stat-fill {
            height: 100%;
            background-color: #4CAF50;
            border-radius: 5px;
        }
        #messageBox {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            display: none;
            z-index: 50;
        }
    </style>
</head>
<body>
    <div id="startScreen">
        <h1>Sky Explorer</h1>
        <input type="text" id="playerName" placeholder="Enter your name">
        
        <div id="aircraftSelection">
            <div class="aircraft-option selected" data-type="cessna">
                <h3>Cessna 172</h3>
                <img src="/api/placeholder/150/100" alt="Cessna 172">
                <div>
                    <div>Speed: <div class="stat-bar"><div class="stat-fill" style="width: 40%"></div></div></div>
                    <div>Maneuverability: <div class="stat-bar"><div class="stat-fill" style="width: 75%"></div></div></div>
                    <div>Durability: <div class="stat-bar"><div class="stat-fill" style="width: 60%"></div></div></div>
                </div>
            </div>
            
            <div class="aircraft-option" data-type="fighter">
                <h3>F-16 Fighter</h3>
                <img src="/api/placeholder/150/100" alt="F-16 Fighter">
                <div>
                    <div>Speed: <div class="stat-bar"><div class="stat-fill" style="width: 90%"></div></div></div>
                    <div>Maneuverability: <div class="stat-bar"><div class="stat-fill" style="width: 85%"></div></div></div>
                    <div>Durability: <div class="stat-bar"><div class="stat-fill" style="width: 70%"></div></div></div>
                </div>
            </div>
            
            <div class="aircraft-option" data-type="biplane">
                <h3>Classic Biplane</h3>
                <img src="/api/placeholder/150/100" alt="Classic Biplane">
                <div>
                    <div>Speed: <div class="stat-bar"><div class="stat-fill" style="width: 30%"></div></div></div>
                    <div>Maneuverability: <div class="stat-bar"><div class="stat-fill" style="width: 95%"></div></div></div>
                    <div>Durability: <div class="stat-bar"><div class="stat-fill" style="width: 40%"></div></div></div>
                </div>
            </div>
        </div>
        
        <button id="startButton" class="button">Start Flying</button>
    </div>
    
    <div id="info">
        <div>Speed: <span id="speed">0</span> km/h</div>
        <div>Altitude: <span id="altitude">0</span> m</div>
        <div>Fuel: <span id="fuel">100</span>%</div>
        <div>Controls: W/S - Pitch, A/D - Roll, Q/E - Yaw, Space - Boost</div>
    </div>
    
    <div id="score">
        Score: <span id="scoreValue">0</span>
    </div>
    
    <div id="messageBox"></div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { Sky } from 'three/addons/objects/Sky.js';
        import { Water } from 'three/addons/objects/Water.js';

        // Game state
        let gameStarted = false;
        let playerName = '';
        let aircraft = null;
        let aircraftType = 'cessna';
        let speed = 0;
        let altitude = 0;
        let fuel = 100;
        let score = 0;
        let collectibles = [];
        let clouds = [];
        
        // Aircraft stats
        const aircraftStats = {
            cessna: {
                maxSpeed: 300,
                acceleration: 0.8,
                maneuverability: 0.03,
                durability: 70,
                fuelConsumption: 0.02
            },
            fighter: {
                maxSpeed: 800,
                acceleration: 2,
                maneuverability: 0.04,
                durability: 90,
                fuelConsumption: 0.05
            },
            biplane: {
                maxSpeed: 200,
                acceleration: 0.5,
                maneuverability: 0.05,
                durability: 50,
                fuelConsumption: 0.01
            }
        };
        
        // DOM elements
        const startScreen = document.getElementById('startScreen');
        const playerNameInput = document.getElementById('playerName');
        const startButton = document.getElementById('startButton');
        const speedElement = document.getElementById('speed');
        const altitudeElement = document.getElementById('altitude');
        const fuelElement = document.getElementById('fuel');
        const scoreElement = document.getElementById('scoreValue');
        const messageBox = document.getElementById('messageBox');
        const aircraftOptions = document.querySelectorAll('.aircraft-option');
        
        // Set up scene
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0xB0E2FF, 0.0005);
        
        // Set up camera
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 50000);
        camera.position.set(0, 100, 300);
        
        // Set up renderer
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);
        
        // Add lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);
        
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(100, 1000, 100);
        directionalLight.castShadow = true;
        directionalLight.shadow.mapSize.width = 2048;
        directionalLight.shadow.mapSize.height = 2048;
        directionalLight.shadow.camera.near = 500;
        directionalLight.shadow.camera.far = 2000;
        directionalLight.shadow.camera.left = -1000;
        directionalLight.shadow.camera.right = 1000;
        directionalLight.shadow.camera.top = 1000;
        directionalLight.shadow.camera.bottom = -1000;
        scene.add(directionalLight);
        
        // Add sky
        const sky = new Sky();
        sky.scale.setScalar(10000);
        scene.add(sky);
        
        const skyUniforms = sky.material.uniforms;
        skyUniforms['turbidity'].value = 10;
        skyUniforms['rayleigh'].value = 2;
        skyUniforms['mieCoefficient'].value = 0.005;
        skyUniforms['mieDirectionalG'].value = 0.8;
        
        const sun = new THREE.Vector3();
        const phi = THREE.MathUtils.degToRad(90 - 10);
        const theta = THREE.MathUtils.degToRad(180);
        sun.setFromSphericalCoords(1, phi, theta);
        skyUniforms['sunPosition'].value.copy(sun);
        
        // Add water
        const waterGeometry = new THREE.PlaneGeometry(100000, 100000);
        const water = new Water(waterGeometry, {
            textureWidth: 512,
            textureHeight: 512,
            waterNormals: new THREE.TextureLoader().load('https://cdn.jsdelivr.net/npm/three-examples@0.160.0/textures/waternormals.jpg', function (texture) {
                texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
            }),
            sunDirection: new THREE.Vector3(),
            sunColor: 0xffffff,
            waterColor: 0x001e0f,
            distortionScale: 3.7,
            fog: scene.fog !== undefined
        });
        water.rotation.x = -Math.PI / 2;
        water.position.y = -50;
        scene.add(water);
        
        // Create terrain
        function createTerrain() {
            const terrainGroup = new THREE.Group();
            
            // Mountains
            for (let i = 0; i < 30; i++) {
                const radius = Math.random() * 400 + 200;
                const height = Math.random() * 1200 + 400;
                const segments = Math.floor(Math.random() * 5) + 5;
                
                const mountainGeometry = new THREE.ConeGeometry(radius, height, segments);
                const mountainMaterial = new THREE.MeshLambertMaterial({ 
                    color: new THREE.Color(0.4, 0.4, 0.4).lerp(new THREE.Color(0.7, 0.7, 0.7), Math.random())
                });
                
                const mountain = new THREE.Mesh(mountainGeometry, mountainMaterial);
                mountain.position.set(
                    (Math.random() - 0.5) * 10000,
                    height / 2 - 50,
                    (Math.random() - 0.5) * 10000
                );
                mountain.castShadow = true;
                mountain.receiveShadow = true;
                
                terrainGroup.add(mountain);
            }
            
            // Islands
            for (let i = 0; i < 15; i++) {
                const radius = Math.random() * 500 + 300;
                const islandGeometry = new THREE.CylinderGeometry(radius, radius, Math.random() * 30 + 20, 32);
                const islandMaterial = new THREE.MeshLambertMaterial({ color: 0x507F3D });
                
                const island = new THREE.Mesh(islandGeometry, islandMaterial);
                island.position.set(
                    (Math.random() - 0.5) * 8000,
                    -40,
                    (Math.random() - 0.5) * 8000
                );
                island.castShadow = true;
                island.receiveShadow = true;
                
                // Add some trees to the island
                const treeCount = Math.floor(Math.random() * 10) + 5;
                for (let j = 0; j < treeCount; j++) {
                    const angle = Math.random() * Math.PI * 2;
                    const distance = Math.random() * (radius * 0.7);
                    
                    const tree = createTree();
                    tree.position.set(
                        Math.cos(angle) * distance,
                        10,
                        Math.sin(angle) * distance
                    );
                    
                    island.add(tree);
                }
                
                terrainGroup.add(island);
            }
            
            // Runway
            const runwayGeometry = new THREE.BoxGeometry(40, 1, 1000);
            const runwayMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
            const runway = new THREE.Mesh(runwayGeometry, runwayMaterial);
            runway.position.set(0, -49, 0);
            runway.receiveShadow = true;
            
            // Runway markings
            for (let i = 0; i < 20; i++) {
                const markingGeometry = new THREE.BoxGeometry(4, 1.1, 20);
                const markingMaterial = new THREE.MeshLambertMaterial({ color: 0xFFFFFF });
                const marking = new THREE.Mesh(markingGeometry, markingMaterial);
                marking.position.set(0, -48.9, -450 + i * 50);
                terrainGroup.add(marking);
            }
            
            terrainGroup.add(runway);
            
            scene.add(terrainGroup);
        }
        
        // Create a tree
        function createTree() {
            const treeGroup = new THREE.Group();
            
            // Trunk
            const trunkGeometry = new THREE.CylinderGeometry(2, 3, 15, 8);
            const trunkMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
            const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
            trunk.position.y = 7.5;
            trunk.castShadow = true;
            treeGroup.add(trunk);
            
            // Foliage
            const foliageGeometry = new THREE.ConeGeometry(10, 25, 8);
            const foliageMaterial = new THREE.MeshLambertMaterial({ color: 0x2E8B57 });
            const foliage = new THREE.Mesh(foliageGeometry, foliageMaterial);
            foliage.position.y = 25;
            foliage.castShadow = true;
            treeGroup.add(foliage);
            
            return treeGroup;
        }
        
        // Create clouds
        function createClouds() {
            for (let i = 0; i < 100; i++) {
                const cloudGroup = new THREE.Group();
                
                const segments = Math.floor(Math.random() * 3) + 3;
                for (let j = 0; j < segments; j++) {
                    const cloudGeometry = new THREE.SphereGeometry(
                        Math.random() * 50 + 50,
                        16,
                        16
                    );
                    const cloudMaterial = new THREE.MeshLambertMaterial({
                        color: 0xFFFFFF,
                        transparent: true,
                        opacity: 0.8,
                    });
                    const cloudSegment = new THREE.Mesh(cloudGeometry, cloudMaterial);
                    
                    cloudSegment.position.set(
                        (Math.random() - 0.5) * 100,
                        (Math.random() - 0.5) * 30,
                        (Math.random() - 0.5) * 100
                    );
                    
                    cloudGroup.add(cloudSegment);
                }
                
                cloudGroup.position.set(
                    (Math.random() - 0.5) * 10000,
                    Math.random() * 1500 + 500,
                    (Math.random() - 0.5) * 10000
                );
                
                clouds.push(cloudGroup);
                scene.add(cloudGroup);
            }
        }
        
        // Create collectibles
        function createCollectibles() {
            const collectibleTypes = [
                { type: 'fuel', color: 0xFFD700, value: 20, model: createFuelCan },
                { type: 'points', color: 0x00FF00, value: 100, model: createStar },
                { type: 'speedBoost', color: 0x00FFFF, value: 10, model: createBoost }
            ];
            
            for (let i = 0; i < 50; i++) {
                const typeIndex = Math.floor(Math.random() * collectibleTypes.length);
                const type = collectibleTypes[typeIndex];
                
                const collectible = {
                    type: type.type,
                    value: type.value,
                    position: new THREE.Vector3(
                        (Math.random() - 0.5) * 8000,
                        Math.random() * 1500 + 200,
                        (Math.random() - 0.5) * 8000
                    ),
                    mesh: type.model(),
                    collected: false
                };
                
                collectible.mesh.position.copy(collectible.position);
                scene.add(collectible.mesh);
                
                collectibles.push(collectible);
            }
        }
        
        function createFuelCan() {
            const group = new THREE.Group();
            
            // Main can
            const canGeometry = new THREE.CylinderGeometry(10, 10, 25, 16);
            const canMaterial = new THREE.MeshLambertMaterial({ color: 0xFF0000 });
            const can = new THREE.Mesh(canGeometry, canMaterial);
            group.add(can);
            
            // Spout
            const spoutGeometry = new THREE.CylinderGeometry(3, 3, 10, 8);
            const spoutMaterial = new THREE.MeshLambertMaterial({ color: 0xDDDDDD });
            const spout = new THREE.Mesh(spoutGeometry, spoutMaterial);
            spout.position.set(7, 15, 0);
            spout.rotation.z = Math.PI / 2;
            group.add(spout);
            
            // Handle
            const handleGeometry = new THREE.TorusGeometry(5, 1, 8, 16, Math.PI);
            const handleMaterial = new THREE.MeshLambertMaterial({ color: 0x000000 });
            const handle = new THREE.Mesh(handleGeometry, handleMaterial);
            handle.position.set(0, 10, 0);
            handle.rotation.x = Math.PI / 2;
            group.add(handle);
            
            return group;
        }
        
        function createStar() {
            const geometry = new THREE.OctahedronGeometry(15, 0);
            const material = new THREE.MeshLambertMaterial({ color: 0xFFD700 });
            const star = new THREE.Mesh(geometry, material);
            
            // Add animation
            star.userData.rotationSpeed = Math.random() * 0.03 + 0.01;
            star.userData.floatSpeed = Math.random() * 0.01 + 0.005;
            star.userData.floatHeight = 0;
            
            return star;
        }
        
        function createBoost() {
            const group = new THREE.Group();
            
            // Arrow shape
            const arrowGeometry = new THREE.ConeGeometry(10, 25, 16);
            const arrowMaterial = new THREE.MeshLambertMaterial({ color: 0x00FFFF });
            const arrow = new THREE.Mesh(arrowGeometry, arrowMaterial);
            arrow.rotation.x = Math.PI / 2;
            group.add(arrow);
            
            // Trail
            const trailGeometry = new THREE.CylinderGeometry(5, 5, 15, 16);
            const trailMaterial = new THREE.MeshLambertMaterial({ color: 0x87CEFA });
            const trail = new THREE.Mesh(trailGeometry, trailMaterial);
            trail.position.set(0, 0, 10);
            trail.rotation.x = Math.PI / 2;
            group.add(trail);
            
            // Add animation
            group.userData.rotationSpeed = Math.random() * 0.05 + 0.02;
            group.userData.floatSpeed = Math.random() * 0.02 + 0.01;
            group.userData.floatHeight = 0;
            
            return group;
        }
        
        // Create aircraft models
        function createAircraft(type) {
            const aircraftGroup = new THREE.Group();
            
            switch (type) {
                case 'cessna':
                    createCessna(aircraftGroup);
                    break;
                case 'fighter':
                    createFighter(aircraftGroup);
                    break;
                case 'biplane':
                    createBiplane(aircraftGroup);
                    break;
                default:
                    createCessna(aircraftGroup);
            }
            
            scene.add(aircraftGroup);
            return aircraftGroup;
        }
        
        function createCessna(group) {
            // Fuselage
            const fuselageGeometry = new THREE.CylinderGeometry(12, 8, 80, 12);
            const fuselageMaterial = new THREE.MeshLambertMaterial({ color: 0xFFFFFF });
            const fuselage = new THREE.Mesh(fuselageGeometry, fuselageMaterial);
            fuselage.rotation.z = Math.PI / 2;
            group.add(fuselage);
            
            // Nose
            const noseGeometry = new THREE.ConeGeometry(12, 20, 12);
            const noseMaterial = new THREE.MeshLambertMaterial({ color: 0xFFFFFF });
            const nose = new THREE.Mesh(noseGeometry, noseMaterial);
            nose.rotation.z = -Math.PI / 2;
            nose.position.x = 50;
            group.add(nose);
            
            // Wings
            const wingGeometry = new THREE.BoxGeometry(15, 4, 120);
            const wingMaterial = new THREE.MeshLambertMaterial({ color: 0xFFFFFF });
            const wings = new THREE.Mesh(wingGeometry, wingMaterial);
            group.add(wings);
            
            // Tail
            const tailGeometry = new THREE.BoxGeometry(25, 4, 30);
            const tailMaterial = new THREE.MeshLambertMaterial({ color: 0xFFFFFF });
            const tail = new THREE.Mesh(tailGeometry, tailMaterial);
            tail.position.x = -40;
            group.add(tail);
            
            // Vertical stabilizer
            const stabilizerGeometry = new THREE.BoxGeometry(25, 25, 4);
            const stabilizerMaterial = new THREE.MeshLambertMaterial({ color: 0xFFFFFF });
            const stabilizer = new THREE.Mesh(stabilizerGeometry, stabilizerMaterial);
            stabilizer.position.x = -40;
            stabilizer.position.y = 12;
            group.add(stabilizer);
            
            // Windows - cockpit
            const cockpitGeometry = new THREE.SphereGeometry(12, 16, 8, 0, Math.PI * 2, 0, Math.PI / 2);
            const cockpitMaterial = new THREE.MeshLambertMaterial({ color: 0x87CEFA, transparent: true, opacity: 0.7 });
            const cockpit = new THREE.Mesh(cockpitGeometry, cockpitMaterial);
            cockpit.rotation.x = Math.PI;
            cockpit.position.set(20, 12, 0);
            group.add(cockpit);
            
            // Propeller
            const propellerGroup = new THREE.Group();
            propellerGroup.position.set(60, 0, 0);
            
            const hubGeometry = new THREE.CylinderGeometry(3, 3, 4, 16);
            const hubMaterial = new THREE.MeshLambertMaterial({ color: 0x444444 });
            const hub = new THREE.Mesh(hubGeometry, hubMaterial);
            hub.rotation.z = Math.PI / 2;
            propellerGroup.add(hub);
            
            const bladeGeometry = new THREE.BoxGeometry(2, 40, 5);
            const bladeMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
            
            const blade1 = new THREE.Mesh(bladeGeometry, bladeMaterial);
            propellerGroup.add(blade1);
            
            const blade2 = new THREE.Mesh(bladeGeometry, bladeMaterial);
            blade2.rotation.z = Math.PI / 2;
            propellerGroup.add(blade2);
            
            group.add(propellerGroup);
            group.userData.propeller = propellerGroup;
            
            // Landing gear
            const wheelGeometry = new THREE.CylinderGeometry(5, 5, 3, 16);
            const wheelMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
            const strut1Geometry = new THREE.CylinderGeometry(1, 1, 15, 8);
            const strutMaterial = new THREE.MeshLambertMaterial({ color: 0x888888 });
            
            // Front wheel
            const frontStrut = new THREE.Mesh(strut1Geometry, strutMaterial);
            frontStrut.position.set(30, -15, 0);
            group.add(frontStrut);
            
            const frontWheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
            frontWheel.position.set(30, -23, 0);
            frontWheel.rotation.x = Math.PI / 2;
            group.add(frontWheel);
            
            // Main landing gear
            const leftStrut = new THREE.Mesh(strut1Geometry, strutMaterial);
            leftStrut.position.set(0, -15, -25);
            group.add(leftStrut);
            
            const leftWheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
            leftWheel.position.set(0, -23, -25);
            leftWheel.rotation.x = Math.PI / 2;
            group.add(leftWheel);
            
            const rightStrut = new THREE.Mesh(strut1Geometry, strutMaterial);
            rightStrut.position.set(0, -15, 25);
            group.add(rightStrut);
            
            const rightWheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
            rightWheel.position.set(0, -23, 25);
            rightWheel.rotation.x = Math.PI / 2;
            group.add(rightWheel);
        }
        
        function createFighter(group) {
            // Fuselage
            const fuselageGeometry = new THREE.CylinderGeometry(10, 7, 100, 8);
            const fuselageMaterial = new THREE.MeshLambertMaterial({ color: 0x888888 });
            const fuselage = new THREE.Mesh(fuselageGeometry, fuselageMaterial);
            fuselage.rotation.z = Math.PI / 2;
            group.add(fuselage);
            
            // Nose
            const noseGeometry = new THREE.ConeGeometry(10, 30, 8);
            const noseMaterial = new THREE.MeshLambertMaterial({ color: 0x888888 });
            const nose = new THREE.Mesh(noseGeometry, noseMaterial);
            nose.rotation.z = -Math.PI / 2;
            nose.position.x = 65;
            group.add(nose);
            
            // Canopy
            const canopyGeometry = new THREE.SphereGeometry(10, 16, 8, 0, Math.PI * 2, 0, Math.PI / 2);
            const canopyMaterial = new THREE.MeshLambertMaterial({ color: 0x222222, transparent: true, opacity: 0.8 });
            const canopy = new THREE.Mesh(canopyGeometry, canopyMaterial);
            canopy.rotation.x = Math.PI;
            canopy.position.set(30, 15, 0);
            group.add(canopy);
            
            // Wings
            const wingGeometry = new THREE.BoxGeometry(30, 3, 80);
            const wingMaterial = new THREE.MeshLambertMaterial({ color: 0x888888 });
            const wings = new THREE.Mesh(wingGeometry, wingMaterial);
            wings.position.y = 2;
            group.add(wings);
            
            // Tail
            const tailGeometry = new THREE.BoxGeometry(20, 3, 30);
            const tailMaterial = new THREE.MeshLambertMaterial({ color: 0x888888 });
            const tail = new THREE.Mesh(tailGeometry, tailMaterial);
            tail.position.x = -50;
            group.add(tail);
            
            // Vertical stabilizer
            const stabilizerGeometry = new THREE.BoxGeometry(20, 20, 3);
            const stabilizerMaterial = new THREE.MeshLambertMaterial({ color: 0x888888 });
            const stabilizer = new THREE.Mesh(stabilizerGeometry, stabilizerMaterial);
            stabilizer.position.x = -50;
            stabilizer.position.y = 10;
            group.add(stabilizer);
            
            // Engines
            const engineGeometry = new THREE.CylinderGeometry(7, 8, 25, 16);
            const engineMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
            
            const leftEngine = new THREE.Mesh(engineGeometry, engineMaterial);
            leftEngine.position.set(-15, -5, -20);
            leftEngine.rotation.z = Math.PI / 2;
            group.add(leftEngine);
            
            const rightEngine = new THREE.Mesh(engineGeometry, engineMaterial);
            rightEngine.position.set(-15, -5, 20);
            rightEngine.rotation.z = Math.PI / 2;
            group.add(rightEngine);
            
            // Afterburner effects
            const afterburnerGeometry = new THREE.CylinderGeometry(5, 2, 20, 16);
            const afterburnerMaterial = new THREE.MeshLambertMaterial({ 
                color: 0xFF5500, 
                transparent: true, 
                opacity: 0.7 
            });
            
            const leftAfterburner = new THREE.Mesh(afterburnerGeometry, afterburnerMaterial);
            leftAfterburner.position.set(-35, -5, -20);
            leftAfterburner.rotation.z = Math.PI / 2;
            leftAfterburner.visible = false;
            group.add(leftAfterburner);
            
            const rightAfterburner = new THREE.Mesh(afterburnerGeometry, afterburnerMaterial);
            rightAfterburner.position.set(-35, -5, 20);
            rightAfterburner.rotation.z = Math.PI / 2;
            rightAfterburner.visible = false;
            group.add(rightAfterburner);
            
            group.userData.afterburners = [leftAfterburner, rightAfterburner];
        }
        
        function createBiplane(group) {
            // Lower wing
            const lowerWingGeometry = new THREE.BoxGeometry(15, 2, 130);
            const wingMaterial = new THREE.MeshLambertMaterial({ color: 0xCC5500 });
            const lowerWing = new THREE.Mesh(lowerWingGeometry, wingMaterial);
            lowerWing.position.y = -5;
            group.add(lowerWing);
            
            // Upper wing
            const upperWingGeometry = new THREE.BoxGeometry(20, 2, 130);
            const upperWing = new THREE.Mesh(upperWingGeometry, wingMaterial);
            upperWing.position.y = 25;
            group.add(upperWing);
            
            // Fuselage
            const fuselageGeometry = new THREE.BoxGeometry(80, 20, 20);
            const fuselageMaterial = new THREE.MeshLambertMaterial({ color: 0xBDB76B });
            const fuselage = new THREE.Mesh(fuselageGeometry, fuselageMaterial);
            group.add(fuselage);
            
            // Nose/engine compartment
            const noseGeometry = new THREE.CylinderGeometry(10, 10, 20, 16);
            const noseMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
            const nose = new THREE.Mesh(noseGeometry, noseMaterial);
            nose.rotation.z = Math.PI / 2;
            nose.position.x = 50;
            group.add(nose);
            
            // Tail
            const tailGeometry = new THREE.BoxGeometry(20, 2, 30);
            const tailMaterial = new THREE.MeshLambertMaterial({ color: 0xCC5500 });
            const tail = new THREE.Mesh(tailGeometry, tailMaterial);
            tail.position.x = -40;
            group.add(tail);
            
            // Vertical stabilizer
            const stabilizerGeometry = new THREE.BoxGeometry(20, 20, 2);
            const stabilizerMaterial = new THREE.MeshLambertMaterial({ color: 0xCC5500 });
            const stabilizer = new THREE.Mesh(stabilizerGeometry, stabilizerMaterial);
            stabilizer.position.x = -40;
            stabilizer.position.y = 10;
            group.add(stabilizer);
            
            // Struts between wings
            const strutGeometry = new THREE.CylinderGeometry(1, 1, 30, 8);
            const strutMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
            
            for (let i = -1; i <= 1; i += 2) {
                const strut1 = new THREE.Mesh(strutGeometry, strutMaterial);
                strut1.position.set(20, 10, i * 40);
                group.add(strut1);
                
                const strut2 = new THREE.Mesh(strutGeometry, strutMaterial);
                strut2.position.set(-20, 10, i * 40);
                group.add(strut2);
            }
            
            // Cockpit
            const cockpitGeometry = new THREE.BoxGeometry(20, 10, 18);
            const cockpitMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
            const cockpit = new THREE.Mesh(cockpitGeometry, cockpitMaterial);
            cockpit.position.set(10, 10, 0);
            group.add(cockpit);
            
            const windshieldGeometry = new THREE.BoxGeometry(5, 10, 18);
            const windshieldMaterial = new THREE.MeshLambertMaterial({ color: 0x87CEFA, transparent: true, opacity: 0.7 });
            const windshield = new THREE.Mesh(windshieldGeometry, windshieldMaterial);
            windshield.position.set(22.5, 10, 0);
            group.add(windshield);
            
            // Propeller
            const propellerGroup = new THREE.Group();
            propellerGroup.position.set(60, 0, 0);
            
            const hubGeometry = new THREE.CylinderGeometry(3, 3, 5, 16);
            const hubMaterial = new THREE.MeshLambertMaterial({ color: 0x444444 });
            const hub = new THREE.Mesh(hubGeometry, hubMaterial);
            hub.rotation.z = Math.PI / 2;
            propellerGroup.add(hub);
            
            const bladeGeometry = new THREE.BoxGeometry(2, 50, 8);
            const bladeMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
            
            const blade1 = new THREE.Mesh(bladeGeometry, bladeMaterial);
            propellerGroup.add(blade1);
            
            const blade2 = new THREE.Mesh(bladeGeometry, bladeMaterial);
            blade2.rotation.z = Math.PI / 2;
            propellerGroup.add(blade2);
            
            group.add(propellerGroup);
            group.userData.propeller = propellerGroup;
            
            // Landing gear
            const wheelGeometry = new THREE.CylinderGeometry(5, 5, 3, 16);
            const wheelMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
            
            const leftWheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
            leftWheel.position.set(0, -18, -30);
            leftWheel.rotation.x = Math.PI / 2;
            group.add(leftWheel);
            
            const rightWheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
            rightWheel.position.set(0, -18, 30);
            rightWheel.rotation.x = Math.PI / 2;
            group.add(rightWheel);
            
            const tailWheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
            tailWheel.scale.set(0.6, 0.6, 0.6);
            tailWheel.position.set(-40, -15, 0);
            tailWheel.rotation.x = Math.PI / 2;
            group.add(tailWheel);
        }
        
        // Flight controls
        const keys = {};
        
        window.addEventListener('keydown', (e) => {
            keys[e.key.toLowerCase()] = true;
        });
        
        window.addEventListener('keyup', (e) => {
            keys[e.key.toLowerCase()] = false;
        });
        
        function updateAircraft() {
            if (!aircraft) return;
            
            // Get current stats
            const stats = aircraftStats[aircraftType];
            
            // Basic flight controls
            const pitchAmount = stats.maneuverability;
            const rollAmount = stats.maneuverability * 1.3;
            const yawAmount = stats.maneuverability * 0.5;
            
            // Control aircraft
            if (keys['w']) {
                aircraft.rotation.z -= pitchAmount;
            }
            if (keys['s']) {
                aircraft.rotation.z += pitchAmount;
            }
            if (keys['a']) {
                aircraft.rotation.y += rollAmount;
            }
            if (keys['d']) {
                aircraft.rotation.y -= rollAmount;
            }
            if (keys['q']) {
                aircraft.rotation.x += yawAmount;
            }
            if (keys['e']) {
                aircraft.rotation.x -= yawAmount;
            }
            
            // Acceleration and boost
            if (keys[' '] && fuel > 0) { // Space for boost
                speed = Math.min(speed + stats.acceleration * 3, stats.maxSpeed * 1.5);
                fuel = Math.max(0, fuel - stats.fuelConsumption * 3);
                
                // Show afterburners on fighter jet
                if (aircraftType === 'fighter' && aircraft.userData.afterburners) {
                    aircraft.userData.afterburners.forEach(afterburner => {
                        afterburner.visible = true;
                    });
                }
            } else {
                speed = Math.min(speed + stats.acceleration, stats.maxSpeed);
                fuel = Math.max(0, fuel - stats.fuelConsumption);
                
                // Hide afterburners
                if (aircraftType === 'fighter' && aircraft.userData.afterburners) {
                    aircraft.userData.afterburners.forEach(afterburner => {
                        afterburner.visible = false;
                    });
                }
            }
            
            // Animate propellers
            if (aircraft.userData.propeller) {
                aircraft.userData.propeller.rotation.z += 0.2 + (speed / 100);
            }
            
            // Calculate direction vector from rotation
            const direction = new THREE.Vector3(0, 0, -1);
            direction.applyQuaternion(aircraft.quaternion);
            
            // Move aircraft in that direction
            aircraft.position.add(direction.multiplyScalar(speed / 10));
            
            // Update altitude
            altitude = Math.max(0, aircraft.position.y + 50);
            
            // Update info display
            speedElement.textContent = Math.floor(speed);
            altitudeElement.textContent = Math.floor(altitude);
            fuelElement.textContent = Math.floor(fuel);
            
            // Check for collisions with collectibles
            checkCollectibles();
            
            // Move camera to follow aircraft
            updateCamera();
            
            // Show low fuel warning
            if (fuel < 20 && !aircraft.userData.lowFuelWarning) {
                showMessage("Low fuel warning! Find fuel cans to continue flying.", 3000);
                aircraft.userData.lowFuelWarning = true;
            } else if (fuel > 30) {
                aircraft.userData.lowFuelWarning = false;
            }
            
            // Basic gravity if no fuel
            if (fuel <= 0 && altitude > 0) {
                aircraft.position.y -= 1;
                showMessage("Out of fuel! Gliding down...", 3000);
            }
        }
        
        function checkCollectibles() {
            // Define collision radius
            const collisionRadius = 40;
            
            collectibles.forEach(collectible => {
                if (!collectible.collected) {
                    // Calculate distance
                    const distance = aircraft.position.distanceTo(collectible.position);
                    
                    // Check for collision
                    if (distance < collisionRadius) {
                        collectCollectible(collectible);
                    }
                }
            });
        }
        
        function collectCollectible(collectible) {
            // Mark as collected
            collectible.collected = true;
            collectible.mesh.visible = false;
            
            // Apply effects
            switch (collectible.type) {
                case 'fuel':
                    fuel = Math.min(100, fuel + collectible.value);
                    showMessage(`+${collectible.value} Fuel`, 2000);
                    break;
                case 'points':
                    score += collectible.value;
                    showMessage(`+${collectible.value} Points`, 2000);
                    break;
                case 'speedBoost':
                    speed += collectible.value * 10;
                    showMessage(`Speed Boost!`, 2000);
                    break;
            }
            
            // Update score display
            scoreElement.textContent = score;
            
            // Spawn a new collectible
            setTimeout(() => {
                collectible.position.set(
                    (Math.random() - 0.5) * 8000,
                    Math.random() * 1500 + 200,
                    (Math.random() - 0.5) * 8000
                );
                collectible.mesh.position.copy(collectible.position);
                collectible.collected = false;
                collectible.mesh.visible = true;
            }, 30000);
        }
        
        function updateCamera() {
            // Offset camera behind and slightly above aircraft
            const cameraDistance = 150;
            const cameraHeight = 50;
            
            // Calculate target position: offset back and up from aircraft
            const backDirection = new THREE.Vector3(0, 0, 1);
            backDirection.applyQuaternion(aircraft.quaternion);
            
            const upDirection = new THREE.Vector3(0, 1, 0);
            
            const targetPosition = new THREE.Vector3().copy(aircraft.position)
                .add(backDirection.multiplyScalar(cameraDistance))
                .add(upDirection.multiplyScalar(cameraHeight));
            
            // Smooth camera movement
            camera.position.lerp(targetPosition, 0.05);
            
            // Look at aircraft
            camera.lookAt(aircraft.position);
        }
        
        function showMessage(text, duration) {
            messageBox.textContent = text;
            messageBox.style.display = 'block';
            
            clearTimeout(messageBox.hideTimeout);
            messageBox.hideTimeout = setTimeout(() => {
                messageBox.style.display = 'none';
            }, duration);
        }
        
        function animateCollectibles() {
            // Animate collectibles (rotation, floating, etc)
            collectibles.forEach(collectible => {
                if (!collectible.collected && collectible.mesh.userData.rotationSpeed) {
                    collectible.mesh.rotation.y += collectible.mesh.userData.rotationSpeed;
                    
                    // Floating animation
                    collectible.mesh.userData.floatHeight += collectible.mesh.userData.floatSpeed;
                    collectible.mesh.position.y = collectible.position.y + 
                                                Math.sin(collectible.mesh.userData.floatHeight) * 10;
                }
            });
        }
        
        function animateClouds() {
            // Move clouds slowly in random directions
            clouds.forEach(cloud => {
                if (!cloud.userData.direction) {
                    cloud.userData.direction = new THREE.Vector3(
                        (Math.random() - 0.5) * 0.2,
                        0,
                        (Math.random() - 0.5) * 0.2
                    );
                }
                
                cloud.position.add(cloud.userData.direction);
                
                // Occasionally change direction
                if (Math.random() < 0.001) {
                    cloud.userData.direction.set(
                        (Math.random() - 0.5) * 0.2,
                        0,
                        (Math.random() - 0.5) * 0.2
                    );
                }
                
                // Wrap around if too far
                const limit = 10000;
                if (cloud.position.x > limit) cloud.position.x = -limit;
                if (cloud.position.x < -limit) cloud.position.x = limit;
                if (cloud.position.z > limit) cloud.position.z = -limit;
                if (cloud.position.z < -limit) cloud.position.z = limit;
            });
        }
        
        // Water animation
        function animateWater() {
            water.material.uniforms['time'].value += 1.0 / 60.0;
        }
        
        // Aircraft selection
        aircraftOptions.forEach(option => {
            option.addEventListener('click', () => {
                // Remove selected class from all options
                aircraftOptions.forEach(opt => opt.classList.remove('selected'));
                
                // Add selected class to clicked option
                option.classList.add('selected');
                
                // Set selected aircraft type
                aircraftType = option.dataset.type;
            });
        });
        
        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        // Start button click handler
        startButton.addEventListener('click', () => {
            playerName = playerNameInput.value.trim() || 'Pilot';
            startGame();
        });
        
        // Start the game
        function startGame() {
            startScreen.style.display = 'none';
            
            // Initialize the world
            createTerrain();
            createClouds();
            createCollectibles();
            
            // Create selected aircraft
            aircraft = createAircraft(aircraftType);
            aircraft.position.set(0, 100, 0);
            
            // Show welcome message
            showMessage(`Welcome, ${playerName}! Collect items and explore the world.`, 5000);
            
            gameStarted = true;
        }
        
        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            
            if (gameStarted) {
                updateAircraft();
                animateCollectibles();
                animateClouds();
                animateWater();
            }
            
            renderer.render(scene, camera);
        }
        
        animate();
    </script>
</body>
</html>
      
